package autocab_api_v2

import (
	"encoding/json"
	"fmt"
	"testing"
	"time"
)

func TestGetBookingFromResponse(t *testing.T) {
	r := `{"continuationToken":"638256996000000000|2",` +
		`"bookings":[{"id":14855,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2023-07-23T08:57:19+01:00","pickupDueTimeUtc":"2023-07-23T07:57:19.0189396Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2023-07-23T08:57:19.0825245+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":2,"modifiedById":null,"pickup":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Abercarn Close, Cheetham Hill, Manchester, M8 9AL","zoneId":494,"coordinate":{"latitude":53.506147,"longitude":-2.241213,"isEmpty":false},"note":"","house":"","street":"Abercarn Close","town":"Cheetham Hill, Manchester","postCode":"M8 9AL","bookingPriority":0},"note":"","type":"Pickup","completed":true,"passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Hightown Post Office, Waterloo Road, Cheetham Hill, Manchester, M8 9SB","zoneId":494,"coordinate":{"latitude":53.506565,"longitude":-2.242958,"isEmpty":false},"note":"","house":"","street":"Hightown Post Office, Waterloo Road","town":"Cheetham Hill, Manchester","postCode":"M8 9SB","bookingPriority":0},"note":"","type":"Destination","completed":false,"passengerDetailsIndex":null},"name":"TEST","telephoneNumber":"","passengerReliabilityRating":"NotSet","bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"","passengers":0,"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":0.0956911636045494,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"E9DE251D5CF741C6B6418A1244D908E8","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2023-07-23T08:58:24.1101811+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cliOptions":{"cliBookingStatus":"NotSet","ivrStatus":"NotSet","ringbackStatus":"NotSet","isMobileNumber":false},"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"pricing":{"promotionCodeDiscount":{"bookedDiscount":0.0,"finalDiscount":0.0},"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"","finishTariff":"","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Shout (Variable Price: Lynkpay test)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"driverConstraints":{"requestedDrivers":[],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"autoApproveInfo":{"driverResponse":"","recipeID":2,"flags":0},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"textKeyword":"","flight":null,"cabExchange":null,"advancedBooking":null,"bookingSuspensions":null,"autoComplete":null,"returnFlight":null,"dispatchDueTime":null,"dispatchDueTimeOverride":null,"dispatchDueTimeOverrideUtc":null,"activeBooking":null,"dispatchedBooking":null,"exchangedBooking":null,"archivedBooking":{"archiveTime":"2023-07-23T08:59:19+01:00","originalAutoID":13727,"reason":"Completed","driver":{"id":2563,"callsign":"1001","fullName":"Farhan Mehmood"},"vehicle":{"id":1991,"callsign":"1001"},"pickedUpAtTime":"2023-07-23T08:58:24.1101811+01:00","dispatchedAtTime":"2023-07-23T08:58:04.8255758+01:00","completedAtTime":"2023-07-23T08:59:18.6638796+01:00","vehicleArrivedAtTime":"2023-07-23T08:58:20.8244052+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"F412 HAN","autoCompleted":false,"completedBy":{"id":1,"name":"Lynkpay Taxis"},"bookedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"completedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"dispatchSource":"LongestWaiting","systemDistance":{"asKilometres":0.15399999999999997,"asMetres":153.99999999999997,"asMiles":0.0956911636045494,"asLocalUnits":0.0956911636045494,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":0.0956911636045494,"type":"mi"},"systemEstimatedPrice":3.0,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"00:00:37.3000000","totalSeconds":37.3}},"cancellationInfo":null}},` +
		`{"id":14856,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2023-07-23T08:57:51+01:00","pickupDueTimeUtc":"2023-07-23T07:57:51.2889820Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2023-07-23T08:57:51.3201536+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":2,"modifiedById":null,"pickup":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Hightown Post Office, Waterloo Road, Cheetham Hill, Manchester, M8 9SB","zoneId":494,"coordinate":{"latitude":53.506565,"longitude":-2.242958,"isEmpty":false},"note":"","house":"","street":"Hightown Post Office, Waterloo Road","town":"Cheetham Hill, Manchester","postCode":"M8 9SB","bookingPriority":0},"note":"","type":"Pickup","completed":true,"passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Abercarn Close, Cheetham Hill, Manchester, M8 9AL","zoneId":494,"coordinate":{"latitude":53.506147,"longitude":-2.241213,"isEmpty":false},"note":"","house":"","street":"Abercarn Close","town":"Cheetham Hill, Manchester","postCode":"M8 9AL","bookingPriority":0},"note":"","type":"Destination","completed":false,"passengerDetailsIndex":null},"name":"TEST","telephoneNumber":"","passengerReliabilityRating":"NotSet","bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"","passengers":0,"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":0.0956911636045494,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"0DB1F9D5235A41B2895D090A32909AF4","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2023-07-23T08:59:27.7454573+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cliOptions":{"cliBookingStatus":"NotSet","ivrStatus":"NotSet","ringbackStatus":"NotSet","isMobileNumber":false},"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"pricing":{"promotionCodeDiscount":{"bookedDiscount":0.0,"finalDiscount":0.0},"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"","finishTariff":"","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Shout (Variable Price: Lynkpay test)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"driverConstraints":{"requestedDrivers":[],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[1991],"forbiddenVehicles":[]},"autoApproveInfo":{"driverResponse":"","recipeID":2,"flags":0},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"textKeyword":"","flight":null,"cabExchange":null,"advancedBooking":null,"bookingSuspensions":null,"autoComplete":null,"returnFlight":null,"dispatchDueTime":null,"dispatchDueTimeOverride":null,"dispatchDueTimeOverrideUtc":null,"activeBooking":null,"dispatchedBooking":null,"exchangedBooking":null,"archivedBooking":{"archiveTime":"2023-07-23T08:59:31+01:00","originalAutoID":13728,"reason":"Completed","driver":{"id":2563,"callsign":"1001","fullName":"Farhan Mehmood"},"vehicle":{"id":1991,"callsign":"1001"},"pickedUpAtTime":"2023-07-23T08:59:27.7454573+01:00","dispatchedAtTime":"2023-07-23T08:59:21.7304541+01:00","completedAtTime":"2023-07-23T08:59:30.7850903+01:00","vehicleArrivedAtTime":"2023-07-23T08:59:24.9373326+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"F412 HAN","autoCompleted":false,"completedBy":{"id":1,"name":"Lynkpay Taxis"},"bookedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"completedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"dispatchSource":"FollowOnBooking","systemDistance":{"asKilometres":0.15399999999999997,"asMetres":153.99999999999997,"asMiles":0.0956911636045494,"asLocalUnits":0.0956911636045494,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":0.0956911636045494,"type":"mi"},"systemEstimatedPrice":3.0,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"00:00:33.7000000","totalSeconds":33.699999999999996}},"cancellationInfo":null}}]}`

	var jsonResponse = []byte(r)
	bookings, continuationToken := GetBookingFromResponse(string(jsonResponse))
	fmt.Printf("continuationToken: %s\nbookings: %+v\n", continuationToken, bookings)
}

func TestGetBookingsFromServerLive(t *testing.T) {
	// current time
	loc, err := time.LoadLocation("Europe/London")
	if err != nil {
		t.Fatal(err)
	}
	to := time.Now().In(loc)
	// from := to.Add(-time.Hour * 24)
	from := to.Add(-time.Hour * 24 * 30)
	// from := to.Add(-time.Hour * 24 * 2)
	bookings := GetBookingsFromServer(testAutocabServerURL, testAutocabKey, from, to)
	fmt.Printf("bookings: %+v\nnumber of bookings: %d\n", bookings, len(bookings))
}

func TestTranslateBookingsToArchiveBookings(t *testing.T) {
	r := `[{"id":14855,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2023-07-23T08:57:19+01:00","pickupDueTimeUtc":"2023-07-23T07:57:19.0189396Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2023-07-23T08:57:19.0825245+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":2,"modifiedById":null,"pickup":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Abercarn Close, Cheetham Hill, Manchester, M8 9AL","zoneId":494,"coordinate":{"latitude":53.506147,"longitude":-2.241213,"isEmpty":false},"note":"","house":"","street":"Abercarn Close","town":"Cheetham Hill, Manchester","postCode":"M8 9AL","bookingPriority":0},"note":"","type":"Pickup","completed":true,"passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Hightown Post Office, Waterloo Road, Cheetham Hill, Manchester, M8 9SB","zoneId":494,"coordinate":{"latitude":53.506565,"longitude":-2.242958,"isEmpty":false},"note":"","house":"","street":"Hightown Post Office, Waterloo Road","town":"Cheetham Hill, Manchester","postCode":"M8 9SB","bookingPriority":0},"note":"","type":"Destination","completed":false,"passengerDetailsIndex":null},"name":"TEST","telephoneNumber":"","passengerReliabilityRating":"NotSet","bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"","passengers":0,"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":0.0956911636045494,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"E9DE251D5CF741C6B6418A1244D908E8","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2023-07-23T08:58:24.1101811+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cliOptions":{"cliBookingStatus":"NotSet","ivrStatus":"NotSet","ringbackStatus":"NotSet","isMobileNumber":false},"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"pricing":{"promotionCodeDiscount":{"bookedDiscount":0.0,"finalDiscount":0.0},"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"","finishTariff":"","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Shout (Variable Price: Lynkpay test)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"driverConstraints":{"requestedDrivers":[],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"autoApproveInfo":{"driverResponse":"","recipeID":2,"flags":0},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"textKeyword":"","flight":null,"cabExchange":null,"advancedBooking":null,"bookingSuspensions":null,"autoComplete":null,"returnFlight":null,"dispatchDueTime":null,"dispatchDueTimeOverride":null,"dispatchDueTimeOverrideUtc":null,"activeBooking":null,"dispatchedBooking":null,"exchangedBooking":null,"archivedBooking":{"archiveTime":"2023-07-23T08:59:19+01:00","originalAutoID":13727,"reason":"Completed","driver":{"id":2563,"callsign":"1001","fullName":"Farhan Mehmood"},"vehicle":{"id":1991,"callsign":"1001"},"pickedUpAtTime":"2023-07-23T08:58:24.1101811+01:00","dispatchedAtTime":"2023-07-23T08:58:04.8255758+01:00","completedAtTime":"2023-07-23T08:59:18.6638796+01:00","vehicleArrivedAtTime":"2023-07-23T08:58:20.8244052+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"F412 HAN","autoCompleted":false,"completedBy":{"id":1,"name":"Lynkpay Taxis"},"bookedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"completedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"dispatchSource":"LongestWaiting","systemDistance":{"asKilometres":0.15399999999999997,"asMetres":153.99999999999997,"asMiles":0.0956911636045494,"asLocalUnits":0.0956911636045494,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":0.0956911636045494,"type":"mi"},"systemEstimatedPrice":3.0,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"00:00:37.3000000","totalSeconds":37.3}},"cancellationInfo":null}},` +
		`{"id":14856,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2023-07-23T08:57:51+01:00","pickupDueTimeUtc":"2023-07-23T07:57:51.2889820Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2023-07-23T08:57:51.3201536+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":2,"modifiedById":null,"pickup":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Hightown Post Office, Waterloo Road, Cheetham Hill, Manchester, M8 9SB","zoneId":494,"coordinate":{"latitude":53.506565,"longitude":-2.242958,"isEmpty":false},"note":"","house":"","street":"Hightown Post Office, Waterloo Road","town":"Cheetham Hill, Manchester","postCode":"M8 9SB","bookingPriority":0},"note":"","type":"Pickup","completed":true,"passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":494,"name":"Cheetham Hill","descriptor":"096","mdtZoneId":96},"source":"TeleAtlas","id":-1,"text":"Abercarn Close, Cheetham Hill, Manchester, M8 9AL","zoneId":494,"coordinate":{"latitude":53.506147,"longitude":-2.241213,"isEmpty":false},"note":"","house":"","street":"Abercarn Close","town":"Cheetham Hill, Manchester","postCode":"M8 9AL","bookingPriority":0},"note":"","type":"Destination","completed":false,"passengerDetailsIndex":null},"name":"TEST","telephoneNumber":"","passengerReliabilityRating":"NotSet","bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"","passengers":0,"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":0.0956911636045494,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"0DB1F9D5235A41B2895D090A32909AF4","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2023-07-23T08:59:27.7454573+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cliOptions":{"cliBookingStatus":"NotSet","ivrStatus":"NotSet","ringbackStatus":"NotSet","isMobileNumber":false},"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"pricing":{"promotionCodeDiscount":{"bookedDiscount":0.0,"finalDiscount":0.0},"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"","finishTariff":"","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Shout (Variable Price: Lynkpay test)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"driverConstraints":{"requestedDrivers":[],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[1991],"forbiddenVehicles":[]},"autoApproveInfo":{"driverResponse":"","recipeID":2,"flags":0},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"textKeyword":"","flight":null,"cabExchange":null,"advancedBooking":null,"bookingSuspensions":null,"autoComplete":null,"returnFlight":null,"dispatchDueTime":null,"dispatchDueTimeOverride":null,"dispatchDueTimeOverrideUtc":null,"activeBooking":null,"dispatchedBooking":null,"exchangedBooking":null,"archivedBooking":{"archiveTime":"2023-07-23T08:59:31+01:00","originalAutoID":13728,"reason":"Completed","driver":{"id":2563,"callsign":"1001","fullName":"Farhan Mehmood"},"vehicle":{"id":1991,"callsign":"1001"},"pickedUpAtTime":"2023-07-23T08:59:27.7454573+01:00","dispatchedAtTime":"2023-07-23T08:59:21.7304541+01:00","completedAtTime":"2023-07-23T08:59:30.7850903+01:00","vehicleArrivedAtTime":"2023-07-23T08:59:24.9373326+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"F412 HAN","autoCompleted":false,"completedBy":{"id":1,"name":"Lynkpay Taxis"},"bookedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"completedByCompanyID":{"id":1,"name":"Lynkpay Taxis"},"dispatchSource":"FollowOnBooking","systemDistance":{"asKilometres":0.15399999999999997,"asMetres":153.99999999999997,"asMiles":0.0956911636045494,"asLocalUnits":0.0956911636045494,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":0.0956911636045494,"type":"mi"},"systemEstimatedPrice":3.0,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"00:00:33.7000000","totalSeconds":33.699999999999996}},"cancellationInfo":null}}]`

	var jsonResponse = []byte(r)
	bookings := make([]Booking, 0)
	err := json.Unmarshal(jsonResponse, &bookings)
	if err != nil {
		t.Fatalf("Error decoding bookings, error: %+v\n", err)
	}
	fmt.Printf("bookings: %+v\n", bookings)

	ab := TranslateBookingsToArchiveBookings(bookings)
	fmt.Printf("archive bookings: %+v\n", ab)
}
