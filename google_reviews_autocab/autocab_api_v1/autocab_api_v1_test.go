package autocab_api_v1

import (
	"encoding/json"
	"fmt"
	"testing"
	"time"
)

func TestGetBookingFromResponse(t *testing.T) {
	r := `[{"id":9145,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T11:47:05+01:00","pickupDueTimeUtc":"2022-06-14T10:47:04.6875518Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T11:47:04.9439024+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"20CDD35802284FFE8E4B89717A602765","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T11:53:57.5572047+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T11:54:09+01:00","originalAutoID":8489,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T11:53:57.5572047+01:00","dispatchedAtTime":"2022-06-14T11:51:25.9429761+01:00","completedAtTime":"2022-06-14T11:54:08.9362021+01:00","vehicleArrivedAtTime":"2022-06-14T11:53:45.1855903+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}},` +
		`{"id":9148,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T13:26:21+01:00","pickupDueTimeUtc":"2022-06-14T12:26:21.0952749Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T13:26:21.1322746+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"B99B18BDAF184AC19B2527F7F915F7DF","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T13:44:40.0379455+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T13:44:49+01:00","originalAutoID":8491,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T13:44:40.0379455+01:00","dispatchedAtTime":"2022-06-14T13:31:48.4094464+01:00","completedAtTime":"2022-06-14T13:44:48.7135813+01:00","vehicleArrivedAtTime":"2022-06-14T13:36:11.3294426+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}},` +
		`{"id":9149,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T13:47:00+01:00","pickupDueTimeUtc":"2022-06-14T12:46:59.6942179Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T13:46:59.7302201+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":1,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"860B62AC29CA49D5864B1D0CD707F590","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T13:50:27.6763437+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T13:51:32+01:00","originalAutoID":8492,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T13:50:27.6763437+01:00","dispatchedAtTime":"2022-06-14T13:48:12.6609693+01:00","completedAtTime":"2022-06-14T13:51:31.5075557+01:00","vehicleArrivedAtTime":"2022-06-14T13:49:43.7818018+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}}]`
	var jsonResponse = []byte(r)
	bookings := make([]Booking, 0)
	err := json.Unmarshal(jsonResponse, &bookings)
	if err != nil {
		t.Fatalf("Error decoding bookings, error: %+v\n", err)
	}
	fmt.Printf("bookings: %+v\n", bookings)
}

func TestGetBookingsFromServerLive(t *testing.T) {
	// current time
	loc, err := time.LoadLocation("Europe/London")
	if err != nil {
		t.Fatal(err)
	}
	to := time.Now().In(loc)
	// from := to.Add(-time.Hour * 24)
	// from := to.Add(-time.Hour * 24 * 30)
	from := to.Add(-time.Hour * 24 * 2)
	bookings := GetBookingsFromServer(testAutocabServerURL, testAutocabKey, from, to)
	fmt.Printf("bookings: %+v\n", bookings)
}

func TestTranslateBookingsToArchiveBookings(t *testing.T) {
	r := `[{"id":9145,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T11:47:05+01:00","pickupDueTimeUtc":"2022-06-14T10:47:04.6875518Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T11:47:04.9439024+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"20CDD35802284FFE8E4B89717A602765","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T11:53:57.5572047+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T11:54:09+01:00","originalAutoID":8489,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T11:53:57.5572047+01:00","dispatchedAtTime":"2022-06-14T11:51:25.9429761+01:00","completedAtTime":"2022-06-14T11:54:08.9362021+01:00","vehicleArrivedAtTime":"2022-06-14T11:53:45.1855903+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}},` +
		`{"id":9148,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T13:26:21+01:00","pickupDueTimeUtc":"2022-06-14T12:26:21.0952749Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T13:26:21.1322746+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":0,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"B99B18BDAF184AC19B2527F7F915F7DF","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T13:44:40.0379455+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T13:44:49+01:00","originalAutoID":8491,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T13:44:40.0379455+01:00","dispatchedAtTime":"2022-06-14T13:31:48.4094464+01:00","completedAtTime":"2022-06-14T13:44:48.7135813+01:00","vehicleArrivedAtTime":"2022-06-14T13:36:11.3294426+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}},` +
		`{"id":9149,"rowVersion":1,"bookingType":"ASAP","returnBookingType":"None","counterpartID":null,"companyId":1,"pickupDueTime":"2022-06-14T13:47:00+01:00","pickupDueTimeUtc":"2022-06-14T12:46:59.6942179Z","pickupDueTimeMode":"Fixed","dropOffTime":null,"dropOffTimeUtc":null,"returnTime":null,"passengerTimeZone":48,"bookedAtTime":"2022-06-14T13:46:59.7302201+01:00","expectedPickupDueTime":null,"validFromPickupDueTime":null,"validToPickupDueTime":null,"bookedById":12,"modifiedById":null,"pickup":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","zoneId":132,"coordinate":{"latitude":52.95514,"longitude":-1.145379,"isEmpty":false},"note":"","house":"","street":"DG City Office, 21A Lower Parliament St, Nottingham NG1 3DA, UK","town":"","postCode":"","bookingPriority":0},"note":"","type":"Pickup","passengerDetailsIndex":0},"vias":[],"destination":{"address":{"zone":{"id":132,"name":"National","descriptor":"130","mdtZoneId":130},"source":"UserTyped","id":-1,"text":"National","zoneId":132,"coordinate":{"latitude":54.102474,"longitude":-2.669678,"isEmpty":false},"note":"","house":"","street":"National","town":"","postCode":"","bookingPriority":0},"note":"","type":"Destination","passengerDetailsIndex":null},"name":"","telephoneNumber":"+44 115 950 0500","cliOptions":{"isMobileNumber":false,"cliBookingStatus":"NotSet","ivrStatus":"ImplicitlyOn","ringbackStatus":"ImplicitlyRingOn"},"bookerName":"","bookerTelephoneNumber":"","greeterName":"","greeterTelephoneNumber":"","passengerInformation":"","driverNote":"hiii driver first","passengers":0,"yourReferences":{"yourReference1":"","yourReference2":"","yourReference3":"","yourReference4":"","yourReference5":"","yourReference6":"","yourReference7":"","yourReference8":""},"ourReference":"","priority":0,"priorityOverride":false,"prioritySource":"None","pricing":{"fare":3.0,"cost":3.0,"price":3.0,"pricingTariff":"Lynkpay test","isManual":false,"isLocked":false,"waitingTime":1,"waitingTimeFree":0,"waitingTimeChargeable":0,"startTariff":"lynk","finishTariff":"lynk","gratuityAmount":0.0,"waitingTimeCost":0.0,"waitingTimePrice":0.0,"loyaltyCardCost":0.0,"extraCost":0.0,"paymentFee":0.0,"bookingFee":0.50,"cashAccountFee":0.0,"kickbackFeeCommission":0.0,"driverCommissionFee":0.0,"serviceChargeFee":0.0,"costSource":"Variable Price: Lynkpay test (Meter Shout)","distanceSource":"Route Calculation: Autocab Routing","accountAmount":0.0,"cardAmount":0.0,"cashAmount":3.0,"paymentTransactions":[],"meterDistance":{"asKilometres":0.0,"asMetres":0.0,"asMiles":0.0,"asLocalUnits":0.0,"isZero":true,"units":"Miles"},"gpsMeterDistance":0.0,"gpsMeterPrice":0.0,"gratuitySettingType":"Amount","gratuitySettingValue":0.0,"bookingCost":null,"bookingPrice":null},"customerId":null,"customerDisplayName":null,"hasSpecialAccount":false,"flight":null,"customerEmail":"","capabilities":[],"officeNote":"","luggage":0,"driverConstraints":{"requestedDrivers":[2526],"forbiddenDrivers":[]},"vehicleConstraints":{"requestedVehicles":[],"forbiddenVehicles":[]},"paymentMethod":"Cash","paymentType":"Cash","repeatSchedule":{"hasRepeats":false,"isFortnightly":false,"repeatDays":[],"skippedDays":[],"endTime":null,"endTimeUtc":null,"bookingSuspensionGroupId":0},"loyaltyCardId":null,"distance":150.715695339219,"distanceSource":"Route Calculation: Autocab Routing","docketNumber":0,"paymentTransactionReference":"860B62AC29CA49D5864B1D0CD707F590","payByLinkDetails":[],"isEasyPay":false,"callID":null,"extraPassengerDetails":[],"stageInfo":[{"visitedTime":"2022-06-14T13:50:27.6763437+01:00","noFare":false},{"visitedTime":null,"noFare":false}],"rejectedVehicles":[],"bookingSource":"OperatorWeb","releaseCode":"","hold":false,"canBeExchanged":true,"wasExchanged":false,"cabExchangeBooking":false,"cabExchange":null,"autoApproveInfo":{"driverResponse":"","recipeID":-1,"flags":1},"questionsAndAnswers":[],"travelProgram":"","corporateAccountTransactionId":null,"corporateAccountDetails":null,"waitAndReturn":false,"outOfAreaDeadMileage":{"amount":0.0,"type":"mi"},"areaCharges":{"totalPrice":0.0,"totalCost":0.0,"totalNonCommissionableCost":0.0},"igoVendorVat":0.0,"igoVendorServiceCharge":0.0,"igoVendorServiceChargeVat":0.0,"igoAgentCommission":0.0,"igoAgentCommissionVat":0.0,"externalBookingReference":"","distanceFromRouteCalc":true,"archivedBooking":{"archiveTime":"2022-06-14T13:51:32+01:00","originalAutoID":8492,"reason":"Completed","driver":{"id":2526,"callsign":"11003","fullName":"Yasir DG  naseem"},"vehicle":{"id":1954,"callsign":"11003"},"pickedUpAtTime":"2022-06-14T13:50:27.6763437+01:00","dispatchedAtTime":"2022-06-14T13:48:12.6609693+01:00","completedAtTime":"2022-06-14T13:51:31.5075557+01:00","vehicleArrivedAtTime":"2022-06-14T13:49:43.7818018+01:00","estimatedPickupTime":null,"plateNumber":"","badgeNumber":"","regNumber":"RV11 YRD","autoCompleted":false,"completedBy":{"id":1,"name":"Connect Test Bench"},"bookedByCompanyID":{"id":1,"name":"Connect Test Bench"},"completedByCompanyID":{"id":1,"name":"Connect Test Bench"},"dispatchSource":"RequestedDriver","systemDistance":{"asKilometres":242.55340000000007,"asMetres":242553.40000000008,"asMiles":150.715695339219,"asLocalUnits":150.715695339219,"isZero":false,"units":"Miles"},"wasExchanged":false,"exchangedBooking":null,"priceComparison":{"gpsMeterDistance":{"amount":0.0,"type":"mi"},"gpsMeterPrice":0.0,"gpsMeterPriceSource":"","systemEstimatedDistance":{"amount":150.715695339219,"type":"mi"},"systemEstimatedPrice":227.57,"systemEstimatedPriceSource":"Variable Price: Lynkpay test","estimatedTime":{"timeSpan":"02:59:36.7000000","totalSeconds":10776.699999999999}},"cancellationInfo":null}}]`
	var jsonResponse = []byte(r)
	bookings := make([]Booking, 0)
	err := json.Unmarshal(jsonResponse, &bookings)
	if err != nil {
		t.Fatalf("Error decoding bookings, error: %+v\n", err)
	}
	fmt.Printf("bookings: %+v\n", bookings)

	ab := TranslateBookingsToArchiveBookings(bookings)
	fmt.Printf("archive bookings: %+v\n", ab)
}

func TestGetSendSMSResponse(t *testing.T) {
	r := `{"sentRecipients":["07123456789"],"unsentRecipients":[]}`
	fmt.Printf("send SMS response: %+v\n", GetSendSMSResponse(r))
}

// This could send an SMS from the live system
func TestSendSMSLive1(t *testing.T) {
	success := SendSMS(testAutocabServerURL, testAutocabKeySendSMS, testTelephone, "test message", "Test sender name")
	fmt.Printf("send SMS response: %t\n", success)
	if !success {
		t.Fatal("Sending SMS failed")
	}
}

func TestSendSMSFailIncoorectKey1(t *testing.T) {
	success := SendSMS(testAutocabServerURL, "wrongkey", testTelephone, "test message", "Test sender name")
	fmt.Printf("send SMS response: %t\n", success)
	if success {
		t.Fatal("Sending SMS worked, should have failed")
	}
}
